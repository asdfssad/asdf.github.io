<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç‰©å“äº¤æ›å¸‚é›†</title>
<style>
body {
font-family: 'Segoe UI', sans-serif;
background-color: #f6f7f9;
margin: 0;
}
header {
background-color: #2c3e50;
color: white;
padding: 1rem 2rem;
display: flex;
justify-content: space-between;
align-items: center;
}
nav a {
color: white;
text-decoration: none;
margin-left: 1rem;
font-weight: bold;
}
.hero {
display: flex;
justify-content: center;
flex-wrap: wrap;
gap: 1rem;
padding: 2rem;
}
.hero-box {
width: 300px;
background: white;
border-radius: 12px;
box-shadow: 0 4px 8px rgba(0,0,0,0.1);
overflow: hidden;
text-align: center;
transition: transform 0.2s;
}
.hero-box:hover { transform: scale(1.03); }
.hero-box img {
width: 100%;
height: 200px;
object-fit: cover;
}
.hero-box h3 { margin: 0.8rem 0 0.2rem; }
.hero-box p { color: #777; margin: 0 0 1rem; }
.hero-box a {
display: inline-block;
background: #2980b9;
color: white;
padding: 0.4rem 1rem;
border-radius: 6px;
margin-bottom: 1rem;
text-decoration: none;
}
.section {
max-width: 800px;
margin: auto;
background: white;
padding: 2rem;
border-radius: 12px;
box-shadow: 0 2px 6px rgba(0,0,0,0.1);
margin-bottom: 2rem;
}
label {
display: block;
margin-top: 1rem;
}
input, select, textarea {
width: 100%;
padding: 0.5rem;
margin-top: 0.3rem;
border-radius: 6px;
border: 1px solid #ccc;
}
button {
margin-top: 1rem;
padding: 0.6rem 1.2rem;
background-color: #2980b9;
color: white;
border: none;
border-radius: 6px;
cursor: pointer;
}
img.preview {
max-width: 150px;
margin-top: 0.5rem;
display: block;
}
</style>
</head>
<body>
<header>
<h1>ğŸ“¦ ç‰©å“äº¤æ›å¸‚é›†</h1>
<nav>
<a href="#post">åˆŠç™»</a>
<span id="user-info" style="margin-left: 1rem;"></span>
<button onclick="showLoginModal()" style="margin-left: 1rem; background:#16a085;">ç™»å…¥</button>
</nav>
</header>

<section style="text-align: center; margin-top: 2rem;">
<h2 style="font-size: 1.8rem; color: #2c3e50;">ğŸ” æƒ³äº¤æ›ä»€éº¼æ±è¥¿å‘¢ï¼Ÿ</h2>
</section>

<section class="section" style="margin-top: 2rem;">
<h2>ğŸ” æœå°‹ç‰©å“</h2>
<label>
é—œéµå­—æœå°‹ï¼š
<input type="text" id="search-keyword" placeholder="è¼¸å…¥ç‰©å“åç¨±æˆ–åˆ†é¡..." oninput="searchItems()" />
</label>
</section>
<section class="hero">
<div class="hero-box">
<img src="book.jpg" alt="æ›¸ç±">
<h3>æ›¸ç±</h3>
<p>å„é¡å¥½æ›¸äº¤æ›</p>
<a href="book.html">more</a>
</div>
<div class="hero-box">
<img src="cloth.jpg" alt="è¡£ç‰©">
<h3>è¡£ç‰©</h3>
<p>æ¸…æ–°ç©¿æ­åˆ†äº«</p>
<a href="cloth.html">more</a>
</div>
<div class="hero-box">
<img src="appliance.jpg" alt="å®¶é›»èˆ‡å·¥å…·">
<h3>å®¶é›»èˆ‡å·¥å…·</h3>
<p>å¯¦ç”¨è£å‚™äº¤æ›</p>
<a href="appliance.html">more</a>
</div>
</section>



<section class="section" id="post">
<h2>ğŸ“¤ åˆŠç™»ç‰©å“</h2>
<label>ç‰©å“åç¨±ï¼š<input type="text" id="item-name" /></label>
<label>ç‰©å“æè¿°ï¼š<textarea id="item-desc"></textarea></label>
<label>ç‹€æ³ï¼š
<select id="item-condition">
<option>å…¨æ–°</option>
<option>ä½¿ç”¨ä¸­</option>
<option>ç‘•ç–µ</option>
</select>
</label>
<label>å¸Œæœ›äº¤æ›çš„é¡å‹ï¼š<input type="text" id="item-type" /></label>
<label>ç‰©å“åˆ†é¡ï¼š
<select id="item-category">
<option value="æ›¸ç±">æ›¸ç±</option>
<option value="è¡£ç‰©">è¡£ç‰©</option>
<option value="å®¶é›»èˆ‡å·¥å…·">å®¶é›»èˆ‡å·¥å…·</option>
</select>
</label>
<label>ä¸Šå‚³åœ–ç‰‡ï¼š<input type="file" id="item-image" accept="image/*" onchange="previewImage(event)" /></label>
<img id="preview" class="preview" style="display:none;" />
<button onclick="postItem()">ğŸ“¤ åˆŠç™»</button>
<div class="item-list" id="item-list"></div>
</section>

<script>
let items = JSON.parse(localStorage.getItem("items")) || [];

function previewImage(event) {
const file = event.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = function(e) {
const img = document.getElementById('preview');
img.src = e.target.result;
img.style.display = 'block';
}
reader.readAsDataURL(file);
}

function postItem() {
const name = document.getElementById('item-name').value.trim();
const desc = document.getElementById('item-desc').value.trim();
const condition = document.getElementById('item-condition').value;
const type = document.getElementById('item-type').value.trim();
const category = document.getElementById('item-category').value;
const owner = localStorage.getItem("loggedInUser"); // è‡ªå‹•å¡«å…¥ç™»å…¥è€…åç¨±
const imageInput = document.getElementById('item-image');
const file = imageInput.files[0];

if (!owner) {
alert("è«‹å…ˆç™»å…¥æ‰èƒ½åˆŠç™»ï¼");
return;
}

if (!name || !desc) {
alert("è«‹å¡«å¯«ç‰©å“åç¨±èˆ‡æè¿°ï¼");
return;
}

const reader = new FileReader();
reader.onload = function(e) {
const imageURL = file ? e.target.result : '';

const newItem = {
name,
desc,
condition,
type,
category,
owner,
imageURL,
likes: [],
comments: [],
favorites: []
};

items.push(newItem);
localStorage.setItem("items", JSON.stringify(items));
displayItems();

// æ¸…ç©ºè¡¨å–®
document.getElementById('item-name').value = '';
document.getElementById('item-desc').value = '';
document.getElementById('item-condition').selectedIndex = 0;
document.getElementById('item-type').value = '';
document.getElementById('item-category').selectedIndex = 0;
document.getElementById('item-image').value = '';
document.getElementById('preview').style.display = 'none';
};

if (file) {
reader.readAsDataURL(file);
} else {
reader.onload({ target: { result: '' } }); // ç„¡åœ–ä¹Ÿèƒ½åˆŠç™»
}
}




function searchItems() {
const keyword = document.getElementById('search-keyword').value.toLowerCase();
const filtered = items.filter(item =>
item.name.toLowerCase().includes(keyword) ||
item.category.toLowerCase().includes(keyword)
);
displayItems(filtered);
}

function displayItems(filtered = items) {
const username = localStorage.getItem("loggedInUser");
const list = document.getElementById('item-list');

// ä¾ç…§æ˜¯å¦è¢«ç™»å…¥è€…æ”¶è—æ’åºï¼šæ”¶è—çš„ç½®é ‚
const sorted = [...filtered].sort((a, b) => {
const aFav = a.favorites?.includes(username) ? 0 : 1;
const bFav = b.favorites?.includes(username) ? 0 : 1;
return aFav - bFav;
});

list.innerHTML = '';

sorted.forEach((item, index) => {
const liked = item.likes?.length || 0;
const isFavorited = item.favorites?.includes(username);

list.innerHTML += `
<div class="item" style="margin-bottom: 1.5rem; border-bottom: 1px solid #ccc; padding-bottom: 1rem;">
<strong>${item.name}</strong> - ${item.condition}<br>
${item.desc}<br>
ğŸ“Œ åˆ†é¡ï¼š${item.category}ï½œæ“æœ‰è€…ï¼š${item.owner}<br>
${item.imageURL ? `<img src="${item.imageURL}" class="preview">` : ''}<br>
â¤ï¸ å–œæ­¡æ•¸é‡ï¼š<strong>${liked}</strong><br>

<button onclick="likeItem(${items.indexOf(item)})" style="margin-top:0.3rem;">ğŸ‘ å–œæ­¡</button>
<button onclick="toggleFavorite(${items.indexOf(item)})" style="margin-top:0.3rem; background-color:${isFavorited ? '#f1c40f' : '#7f8c8d'};">
${isFavorited ? 'â­ å·²æ”¶è—' : 'ğŸ¤ æ”¶è—'}
</button>
<button onclick="deleteItem(${items.indexOf(item)})" style="background-color:#e74c3c; margin-top:0.5rem;">âŒ åˆªé™¤</button>

<div style="margin-top:1rem;">
<h4>ğŸ’¬ ç•™è¨€</h4>
<div id="comments-${items.indexOf(item)}" style="margin-bottom:0.5rem;">
${
item.comments?.length > 0
? item.comments.map(c => `<div style="border:1px solid #ddd; border-radius:6px; padding:0.4rem; margin-bottom:0.4rem;"><strong>${c.user}ï¼š</strong>${c.text}</div>`).join('')
: '<em>ç›®å‰æ²’æœ‰ç•™è¨€</em>'
}
</div>
<input type="text" id="comment-input-${items.indexOf(item)}" placeholder="è¼¸å…¥ç•™è¨€..." style="width:80%; padding:0.4rem;" />
<button onclick="addComment(${items.indexOf(item)})" style="margin-left:0.5rem;">â• ç•™è¨€</button>
</div>
</div>
`;
});
}


function toggleFavorite(index) {
const username = localStorage.getItem("loggedInUser");
if (!username) {
alert("è«‹å…ˆç™»å…¥æ‰èƒ½æ”¶è—ï¼");
return;
}

const favorites = items[index].favorites || [];

if (favorites.includes(username)) {
items[index].favorites = favorites.filter(u => u !== username);
} else {
favorites.push(username);
items[index].favorites = favorites;
}

localStorage.setItem("items", JSON.stringify(items));
displayItems();
}



function deleteItem(index) {
if (confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ç‰©å“å—ï¼Ÿ")) {
items.splice(index, 1);
localStorage.setItem("items", JSON.stringify(items));
displayItems();
}
}

displayItems();
function showLoginModal() {
document.getElementById("login-modal").style.display = "flex";
}

function hideLoginModal() {
document.getElementById("login-modal").style.display = "none";
}

function login() {
const phone = document.getElementById("login-phone").value.trim();
const password = document.getElementById("login-password").value.trim();

if (!phone || !password) {
alert("è«‹å¡«å¯«å¸³è™Ÿèˆ‡å¯†ç¢¼ï¼");
return;
}

// ä¸æª¢æŸ¥å…§å®¹ï¼Œç›´æ¥ç™»å…¥
localStorage.setItem("loggedInUser", phone);
updateLoginStatus();
hideLoginModal();
}

function logout() {
localStorage.removeItem("loggedInUser");
updateLoginStatus();
}

function updateLoginStatus() {
const userInfo = document.getElementById("user-info");
const postSection = document.getElementById("post");
const loginButton = document.querySelector("nav button");
const username = localStorage.getItem("loggedInUser");

if (username) {
userInfo.innerHTML = `ğŸ‘¤ ${username} | <a href="#" onclick="logout()" style="color: #f39c12;">ç™»å‡º</a>`;
postSection.style.display = "block";
loginButton.style.display = "none";
} else {
userInfo.innerHTML = "";
postSection.style.display = "none";
loginButton.style.display = "inline-block";
}
}


// é é¢è¼‰å…¥æ™‚åˆ¤æ–·æ˜¯å¦å·²ç™»å…¥
updateLoginStatus();

function likeItem(index) {
const username = localStorage.getItem("loggedInUser");
if (!username) {
alert("è«‹å…ˆç™»å…¥æ‰èƒ½æŒ‰å–œæ­¡ï¼");
return;
}

if (!items[index].likes) {
items[index].likes = [];
}

if (items[index].likes.includes(username)) {
alert("ä½ å·²ç¶“æŒ‰éé€™å€‹ç‰©å“äº†ï¼");
return;
}

items[index].likes.push(username);
localStorage.setItem("items", JSON.stringify(items));
displayItems();
}
function addComment(index) {
const username = localStorage.getItem("loggedInUser");
if (!username) {
alert("è«‹å…ˆç™»å…¥æ‰èƒ½ç•™è¨€ï¼");
return;
}

const input = document.getElementById(`comment-input-${index}`);
const text = input.value.trim();

if (!text) {
alert("ç•™è¨€ä¸èƒ½ç‚ºç©ºï¼");
return;
}

if (!items[index].comments) {
items[index].comments = [];
}

items[index].comments.push({
user: username,
text: text
});

localStorage.setItem("items", JSON.stringify(items));
displayItems(); // é‡æ–°é¡¯ç¤ºç•™è¨€
}

function toggleFavorite(index) {
const username = localStorage.getItem("loggedInUser");
if (!username) {
alert("è«‹å…ˆç™»å…¥æ‰èƒ½æ”¶è—ï¼");
return;
}

if (!items[index].favorites) {
items[index].favorites = [];
}

const favList = items[index].favorites;
const userIndex = favList.indexOf(username);

if (userIndex !== -1) {
favList.splice(userIndex, 1); // ç§»é™¤æ”¶è—
} else {
favList.push(username); // åŠ å…¥æ”¶è—
}

localStorage.setItem("items", JSON.stringify(items));
displayItems();
}




</script>
<div id="login-modal" style="
display: none;
position: fixed;
top: 0; left: 0;
width: 100%; height: 100%;
background: rgba(0,0,0,0.5);
justify-content: center;
align-items: center;
z-index: 1000;
">
<div style="
background: white;
padding: 2rem;
border-radius: 12px;
width: 300px;
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
position: relative;
">
<h3 style="margin-top: 0;">ğŸ” ç™»å…¥</h3>
<label>å¸³è™Ÿï¼š<input type="text" id="login-phone" /></label>
<label>å¯†ç¢¼ï¼š<input type="password" id="login-password" /></label>
<button onclick="login()" style="margin-top: 1rem; width: 100%;">ç™»å…¥</button>
<button onclick="hideLoginModal()" style="margin-top: 0.5rem; width: 100%; background: #bdc3c7;">å–æ¶ˆ</button>
</div>
</div>

</body>
</html>
